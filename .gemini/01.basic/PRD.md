# Prezento AI Coach - 製品要求仕様書 (PRD) v5.0

## 1. 概要

**Prezento AI Coach**は、AIを活用してユーザーのプレゼンテーションおよび対話能力向上を支援するための、Google Chrome拡張機能およびWebアプリケーションです。ユーザーは**「フリープレイモード」**で自由に練習し、客観的なフィードバックを得られるほか、**「ミッションモード」**で特定のシナリオに挑戦し、より実践的なスキルを磨くことができます。

## 2. 目的と背景

多くの人がプレゼンテーションに対して苦手意識を持っていますが、効果的な練習方法や客観的なフィードバックを得る機会は限られています。本製品は、場所や時間を選ばずに質の高いフィードバックを提供し、ユーザーが自信を持ってプレゼンに臨めるようになることを目的としています。

## 3. ターゲットユーザー

*   重要なプレゼンを控えたビジネスパーソン
*   学術発表や就職活動を控えた学生
*   自身の話し方を客観的に評価し、改善したいと考えているすべての人

## 4. 主要機能

### 4.1. 共通機能

#### 4.1.1. ユーザー認証

*   Googleアカウントを利用したFirebase Authenticationによる認証機能を持ちます。
*   Chrome拡張機能とWebアプリケーションで認証状態は共有されます。

### 4.2. Chrome拡張機能 (`/extension`)

ブラウザのツールバーからアクセスするポップアップUIを提供し、練習の起点となる機能です。

#### 4.2.1. UIコンポーネント (`popup.html`)

*   **認証状態の表示**: ログイン状態に応じて、ユーザー情報とログアウトボタン、またはログインボタンを表示します。
*   **練習モード選択**:
    *   **フリープレイ**: ユーザーが自由に設定をカスタマイズして練習するモード。
    *   **ミッション**: 事前に定義されたシナリオとクリア条件に挑戦するモード。
*   **練習コントロール**:
    *   `[練習を開始]` ボタン: フリープレイモードの練習を開始します。
    *   `[運命に挑む]` ボタン: ミッションモードで選択したミッションを開始します。
    *   `[練習を終了]` ボタン: フリープレイモードの練習を終了します。

---

#### 4.2.2. フリープレイモード設定

*練習モードで「フリープレイ」が選択されている場合に表示されます。*

*   **役割**: 「プレゼンター」「思考パートナー」から練習の目的を選択します。
*   **ペルソナ**: AIフィードバックの視点となるペルソナを自由記述で設定できます。（例: 「あなたは投資家です」）
*   **フィードバック方法**: 「リアルタイム」「バッジ通知」「サマリーのみ」を選択します。
*   **詳細設定（アコーディオン）**:
    *   **表情分析**: 顔の表情を分析に含めるかを選択します。
    *   **言語**: 日本語/英語を選択します。
    *   **無音検知の閾値**: 音声入力の感度をスライダーで調整します。
    *   **無音とみなす時間**: ポーズ（間）として認識する秒数をスライダーで調整します。

---

#### 4.2.3. ミッションモード (`mission.html`)

*練習モードで「ミッション」を選択し、開始ボタンを押すと専用のタブで開かれます。*

*   **ミッションブリーフィング**:
    *   ミッションのタイトル、シナリオ、クリア条件、**制限時間**が表示されます。
*   **対話ログ**:
    *   ユーザーとAIの対話が時系列で表示されます。
*   **ステータスパネル**:
    *   AIの応答状況や、**残り時間のカウントダウンタイマー**が表示されます。
*   **ミッションコントロール**:
    *   `[対話を終了して採点する]` ボタン: 途中でミッションを終了し、採点に進みます。
*   **結果表示**:
    *   採点完了後、クリア条件に基づいたスコアと総評が表示されます。
    *   `[ランキングを見る]` ボタン: Webアプリのランキング画面に遷移します。

#### 4.2.4. 主要なロジックと分析機能 (`popup.js`, `background.js`)

*   **認証処理**: Google OAuth2認証フローを開始し、取得したIDトークンでFirebaseにサインインします。認証状態はバックグラウンドで管理されます。
*   **設定の永続化**: ユーザーが選択した各種設定は `chrome.storage.local` に保存され、次回起動時に復元されます。
*   **フリープレイモードのデータ収集**:
    *   `[練習を開始]` ボタンクリックで、マイクやカメラのデータ収集を開始します。
    *   `[練習を終了]` ボタンクリックで、収集を停止し、データをCloud Functionsへ送信して分析を依頼します。
*   **ミッションモードの制御**:
    *   `[運命に挑む]` ボタンクリックで、`mission.html` を開き、Firestoreからミッションデータを読み込みます。
    *   ミッションに設定された**制限時間**に基づき、バックグラウンドでタイマーが作動します。
    *   時間切れ、またはユーザーが終了ボタンを押すと、対話ログ全体をCloud Functionsに送信して**ミッション採点**を依頼します。
*   **発話検知 (VAD - Voice Activity Detection)**: クライアントサイドでリアルタイムに音声の無音区間を検知します。
*   **表情分析**: (フリープレイモードのみ) ユーザーが許可した場合、カメラ映像をリアルタイムで分析し、表情、視線、ジェスチャーなどの非言語的コミュニケーションを評価します。
*   **画面内容分析**: (フリープレイモードのみ) ユーザーが許可した場合、画面共有しているスライドや資料の内容を分析します。

### 4.3. Webアプリケーション (`/webapp`)

練習の履歴を詳細に振り返り、パフォーマンスの傾向を分析するためのWebアプリケーションです。

#### 4.3.1. ダッシュボード (`dashboard.html`)

*   **タブUI**: 「分析」「アクティビティ」「ランキング」の3つのタブで情報を整理します。
*   **分析タブ**:
    *   **パフォーマンスサマリー**: 全セッションの最高・平均・最低スコアを表示します。
    *   **スコア推移チャート**: 過去の練習セッションの総合スコアの推移を折れ線グラフで視覚化します。
*   **アクティビティタブ**:
    *   過去の練習セッションをリスト形式で表示します。
    *   各セッションをクリックすると、詳細なレポートページ (`session.html`) に遷移します。
*   **ランキングタブ**:
    *   ミッションモードの成績をミッションごとにランキング形式で表示します。
    *   ドロップダウンでミッションを選択し、該当ミッションのトップランカーのスコアを確認できます。

#### 4.3.2. 練習レポート (`session.html`)

*   個別の練習セッションの詳細なフィードバックと分析結果を表示します。
*   **総合スコアとレーダーチャート**: 5つの評価指標（明朗さ、情熱など）のスコアをレーダーチャートで表示し、得意・不得意な点を視覚的に把握できます。
*   **AIによるフィードバック**:
    *   良かった点 (`highlight`) と改善点 (`advice`) をテキストで表示します。
    *   設定したペルソナからのコメントを表示します。
*   **AIからの質問リスト**: プレゼン内容に基づいてAIが生成した想定質問をリストで確認できます。
*   **リアルタイムフィードバック履歴**: 練習中に行われたリアルタイムのフィードバックと、それに対応する発話内容を時系列で確認できます。

### 4.4. バックエンド処理 (`/functions`)

#### 4.4.1. 認証

*   **HTTPトリガー**: Chrome拡張機能からのHTTPSリクエストによってメインの分析関数が起動します。
*   **認証チェック**: 関数は実行の最初に、リクエストヘッダーに含まれるFirebase IDトークンを検証します。

#### 4.4.2. フリープレイモード: マルチモーダル分析パイプライン

*   **音声分析 (Speech-to-Text)**, **映像分析 (Vision AI)**, **画面内容分析 (Vision AI OCR)** を並行して実行します。

#### 4.4.3. フリープレイモード: 総合フィードバックとサマリー生成

*   **サービス**: **Google Gemini API**
*   **ロジック**: 各種分析結果とユーザー設定（ペルソナ等）を基に、5つの指標別スコア、総評サマリー、ペルソナコメント、想定質問を生成します。

#### 4.4.4. ミッションモード: 採点処理

*   **トリガー**: `mission.html` からのHTTPSリクエスト。
*   **入力**: 対話ログ全体、ミッションID。
*   **ロジック**:
    1.  Firestoreからミッションの「クリア条件 (`objective`)」を取得します。
    2.  対話ログとクリア条件を基に、**Gemini API**が達成度を評価し、スコアと総評を生成します。
*   **出力**: 採点結果（スコア、総評）を `mission.html` に返します。

#### 4.4.5. 結果の保存

*   **フリープレイモード**:
    *   分析と生成が完了したサマリーデータを、Firestoreの `/users/{userId}/sessions/` 以下に書き込みます。
*   **ミッションモード**:
    *   採点が完了したスコアデータを、`/users/{userId}/mission_results/` に記録します。
    *   同時に、全ユーザーのハイスコアを管理する `/mission_high_scores/` コレクションを更新し、ランキング機能を実現します。

## 5. データモデル

### 5.1. `users/{userId}/sessions/{sessionId}`

*   フリープレイモードの練習セッションごとのデータを格納するコレクション。
    *   `scores`: (map) 5つの指標 (`clarity`, `passion`, `logic`, `structure`, `confidence`) の0-100点のスコア。
    *   `highlight`: (string) AIによる総評（良かった点）。
    *   `advice`: (string) AIによる総評（改善点）。
    *   `persona_comment`: (string) 設定されたペルソナからのコメント。
    *   `questions`: (array) AIが生成した想定質問のリスト。
    *   `feedbackHistory`: (array) リアルタイムフィードバックの履歴。
    *   `createdAt`: (timestamp) 練習の作成日時。

### 5.2. `missions/{missionId}` (新規)

*   ミッションの定義を格納するコレクション。
    *   `title`: (string) ミッション名
    *   `scenario`: (string) 状況設定
    *   `objective`: (string) クリア条件。Geminiへの評価プロンプトにも利用。
    *   `persona`: (string) 対話相手となるAIのペルソナ設定。
    *   `timeLimitSeconds`: (number) 制限時間（秒）。

### 5.3. `mission_high_scores/{compositeId}` (新規)

*   ミッションごとの全ユーザーの最高得点を格納するコレクション（ランキング用）。
    *   `missionId`: (string) ミッションID
    *   `userId`: (string) ユーザーID
    *   `userName`: (string) ユーザー名
    *   `score`: (number) 最高得点
    *   `updatedAt`: (timestamp) 更新日時

## 6. 技術スタック

*   **フロントエンド**: HTML, CSS, JavaScript
*   **バックエンド & DB**: Firebase (Authentication, Cloud Firestore, Cloud Functions for Firebase)
*   **AI & MLサービス**:
    *   **Google Gemini API**: 総合フィードバック、スコア、サマリー生成、ミッション採点
    *   **Google Cloud Speech-to-Text API**: 音声文字起こし
    *   **Google Cloud Vision AI API**: 表情分析、スライドOCR
*   **ライブラリ**: Chart.js (チャート描画)
*   **プラットフォーム**: Google Chrome 拡張機能, Web

## 7. 非機能要件

### 7.1. パフォーマンス

*   **拡張機能ポップアップ**: クリック後、0.5秒以内に表示が完了すること。
*   **Webアプリケーション**: 各ページの初回読み込みは3秒以内、ページ遷移は1秒以内に完了すること。
*   **生成AIのリアルタイムフィードバック**: 未達成 サーバーリクエストから3秒以内。
*   **AIによる分析**:
    *   **フリープレイモード**: 未達成 練習終了後、サマリーページが表示されるまでの時間は、練習時間1分あたり10秒以内を目安とする。
    *   **ミッションモード**: 未達成 採点要求後、10秒以内に結果が表示されること。

### 7.2. セキュリティ

*   すべての通信はHTTPSで暗号化されること。
*   ユーザーの練習データは、本人のアカウントに紐づくFirestoreドキュメントにのみ保存され、他のユーザーからはアクセスできないこと。
*   Cloud Functionsは、Firebase AuthenticationによるIDトークン検証を必須とすること。

### 7.3. ユーザビリティ

*   ターゲットユーザーがマニュアルを読まなくても、直感的に基本操作を行えること。
*   UIは日本語で提供され、専門用語は極力避けるか、分かりやすい表現を用いること。

### 7.4. スケーラビリティと可用性

*   バックエンドはFirebaseおよびGoogle Cloudのサーバーレスアーキテクチャで構築するため、ユーザー数の増減に自動的にスケール対応できること。
*   FirebaseのSLAに基づき、99.9%以上のサービス可用性を目指す。

## 8. 将来の展望（ロードマップ）

*   **音声分析機能の高度化**:
    *   声量 x ピッチ x 感情を分析し、より洗練された言語コミュニケーションの実現へ
*   **示唆を得る**:
    *   ユーザー自身のペルソナ設定を可能に
    *   AIと思索を深める壁打ちモード
*   **多言語対応の強化**:
    *   英語対応により、英語コミュニケーションの強化が可能に
*   **ミッションモードの拡充**:
    *   様々なシチュエーションに対応したミッションの追加
    *   Live APIなどの最新技術による、より満足度の高い体験へ
    *   外部とのコラボレーション (著名人、VTuber、企業)
*   **ゲーミフィケーション**:
    *   特定の条件を達成するとバッジや称号を獲得できるアチーブメント機能。
*   **より豊かなプレゼン体験の提供**:
    *   ペルソナ設定の保存
    *   表情分析機能の強化 (一定間隔で判定し画面通知)
    *   スクリプト(台本)表示
    *   制限時間設定
    *   専門的シチュエーションへの対応 (スタートアップピッチ、採用面談、講演会)

## 9. 対象外（スコープ外）

*   **リアルタイム共同練習**: 複数人が同時に同じセッションに参加する機能。
*   **オフラインモード**: インターネット接続がない状態での練習機能。
*   **他ブラウザ対応**: 本製品はGoogle Chrome拡張機能としてのみ提供し、SafariやFirefox等は対象外とする。
*   **外部ツール連携**: Google SlidesやPowerPointなどのプレゼンテーションツールとの直接的な連携。
